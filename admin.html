<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Amazon Control</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap');
        body { font-family: 'Kanit', sans-serif; background: #1b3022; color: white; padding: 20px; margin: 0; }
        .container { background: rgba(0,0,0,0.5); padding: 30px; border-radius: 20px; border: 1px solid #a2cf6e; max-width: 900px; margin: 40px auto; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { color: #a2cf6e; text-align: center; margin-top: 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: rgba(255,255,255,0.05); }
        th, td { padding: 15px; border-bottom: 1px solid #5d8a39; text-align: left; }
        th { color: #a2cf6e; background: #2d5a27; }
        .btn-edit { background: #ffc107; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; color: #000; font-weight: bold; margin-right: 5px; }
        .btn-del { background: #ff5252; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-back { display: inline-block; margin-bottom: 10px; background: none; color: #a2cf6e; border: 1px solid #a2cf6e; padding: 8px 15px; border-radius: 20px; cursor: pointer; text-decoration: none; font-size: 14px; }
        .btn-back:hover { background: #a2cf6e; color: #1b3022; }
        tr:hover { background: rgba(255,255,255,0.1); }
        .loading { text-align: center; padding: 20px; font-style: italic; color: #888; }
    </style>
</head>
<body>

    <div class="container">
        <a href="index.html" class="btn-back">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</a>
        <h2>üõ† ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏®‡∏¥‡∏©‡∏¢‡πå‡πÄ‡∏Å‡πà‡∏≤</h2>
        
        <table id="adminTable">
            <thead>
                <tr>
                    <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                    <th>‡∏£‡∏∏‡πà‡∏ô</th>
                    <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="data-list">
                <tr><td colspan="4" class="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏û‡∏á‡πÑ‡∏û‡∏£...</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        // ‡πÉ‡∏ä‡πâ URL ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ index.html
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxenJW7x8Tt-L60AUXUTBxGNhAIDHtWq6IPXrm0LJVoO0LoPsAYqwozO5DQ6kCrMh91/exec';

        // 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (doGet)
        async function loadData() {
            const tbody = document.getElementById('data-list');
            try {
                const res = await fetch(SCRIPT_URL);
                const data = await res.json();
                tbody.innerHTML = '';
                
                if (data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏û‡∏á‡πÑ‡∏û‡∏£</td></tr>';
                    return;
                }

                data.forEach((item, index) => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${item.name}</td>
                            <td>${item.batch}</td>
                            <td>${item.phone}</td>
                            <td>
                                <button class="btn-edit" onclick="editData(${index},'${item.name}','${item.batch}','${item.phone}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                <button class="btn-del" onclick="deleteData(${index})">‡∏•‡∏ö</button>
                            </td>
                        </tr>`;
                });
            } catch (e) { 
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:#ff5252;">‚ö†Ô∏è ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏µ‡∏ï‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</td></tr>'; 
            }
        }

        // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (doPost)
        async function sendAction(payload) {
            try {
                // ‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î no-cors ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Security ‡∏Ç‡∏≠‡∏á Google Apps Script
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    body: JSON.stringify(payload)
                });
                return true;
            } catch (e) {
                console.error(e);
                return false;
            }
        }

        // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        async function deleteData(index) {
            if (confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏õ‡πà‡∏≤?")) {
                const tbody = document.getElementById('data-list');
                tbody.innerHTML = '<tr><td colspan="4" class="loading">Ê≠£Âú®‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';
                
                await sendAction({ action: 'delete', index: index });
                
                alert("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ");
                setTimeout(loadData, 2000);
            }
        }

        // 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        async function editData(index, oldName, oldBatch, oldPhone) {
            const newName = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:", oldName);
            const newBatch = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà:", oldBatch);
            const newPhone = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:", oldPhone);

            if (newName && newBatch && newPhone) {
                const tbody = document.getElementById('data-list');
                tbody.innerHTML = '<tr><td colspan="4" class="loading">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç...</td></tr>';

                await sendAction({
                    action: 'edit',
                    index: index,
                    name: newName,
                    batch: newBatch,
                    phone: newPhone
                });

                alert("‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ");
                setTimeout(loadData, 2000);
            }
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
        window.onload = loadData;
    </script>
</body>
</html>
